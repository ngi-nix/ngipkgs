## How to install software from NGIpkgs

Installation of software from NGIpkgs currently requires Nix [flakes to be enabled](https://wiki.nixos.org/wiki/Flakes).

###  Run a **standalone programs** locally with Nix

```
nix run github:ngi-nix/ngipkgs#atomic-cli
```

This example uses atomic-cli, but the same can be done with any packages from NGIpkgs that is designed to be run as a standalone program. The list of these packages can be generated by running the following command inside a downloaded copy of the ngipkgs repo:
```
grep -r mainProgram pkgs/by-name
```

### Deploy **services** to machines running NixOS

1. Download a local copy of the nixpkgs repo to use it to deploy services:
```
git clone https://github.com/ngi-nix/ngipkgs.git
```

2. There is a `deploy` directory within ngipkgs that is setup for easy deployment of services. Enter this directory and edit the flake.nix there to enable a service by removing comments from its module and example config. For example, this would enable the Kbin service:
```
modules = [
  [...]
  ### VULA
  # ngipkgs.nixosModules."services.vula"
  # ./Vula/example-simple.nix
  ###
  ### KBIN
  ngipkgs.nixosModules."services.kbin"
  ./Kbin/example.nix
  ###
  ### PEERTUBE
  # ngipkgs.nixosModules."services.peertube.plugins"
  # ./PeerTube/example.nix
  ###
  [...]
  ];
```

3. Still inside of the `deploy` directory, run the following commands to build and deploy a local QEMU VM running the enabled service:
```
nix build .#nixosConfigurations.myMachine.config.system.build.vm && export QEMU_NET_OPTS="hostfwd=tcp::2221-:22,hostfwd=tcp::8080-:80" && ./result/bin/run-nixos-vm
```

QEMU will open its own terminal window that shows the boot log. It is possible to login via this terminal (username `user`, password `pass`), but the UX will usually be better with a regular SSH login:
```
ssh -oUserKnownHostsFile=/dev/null -oStrictHostKeyChecking=no user@localhost -p 2221
```

#### Services available for deployment

An up to date list of services with example configs that are ready to be deployed can be found by running this command in the main ngipkgs repo:
```
find ./projects -type f -name 'example*.nix'
```

There is also a longer list of services that have working tests (or more complex example configs) which can be adapted to a functional deployment config if one doesn't exist already. To view a list of these services, run the following command in the ngipkgs repo:
```
find ./projects -name 'test*'
```
