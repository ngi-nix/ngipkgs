From 4b007ce4bd36033297f12db2f065f5b111d2f7af Mon Sep 17 00:00:00 2001
From: eljamm <fedi.jamoussi@protonmail.ch>
Date: Tue, 2 Dec 2025 10:10:42 +0100
Subject: [PATCH 1/2] Get database credentials from environment variables

See https://www.postgresql.org/docs/current/libpq-envars.html
---
 pkg/SSTorytime/SSTorytime.go | 29 ++++++++++++++++++++++++++++-
 1 file changed, 28 insertions(+), 1 deletion(-)

diff --git a/pkg/SSTorytime/SSTorytime.go b/pkg/SSTorytime/SSTorytime.go
index bb600fb..91b7717 100644
--- a/pkg/SSTorytime/SSTorytime.go
+++ b/pkg/SSTorytime/SSTorytime.go
@@ -490,6 +490,7 @@ func Open(load_arrows bool) PoSST {
 	// Replace this with a private file
 
 	var (
+		host     = "localhost"
 		user     = "sstoryline"
 		password = "sst_1234"
 		dbname   = "sstoryline"
@@ -497,7 +498,33 @@ func Open(load_arrows bool) PoSST {
 
 	user,password,dbname = OverrideCredentials(user,password,dbname)
 
-        connStr := "user="+user+" dbname="+dbname+" password="+password+" sslmode=disable"
+	PGUSER := os.Getenv("PGUSER")
+	PGHOST := os.Getenv("PGHOST")
+	PGDATABASE := os.Getenv("PGDATABASE")
+	PGPASSWORD := os.Getenv("PGPASSWORD")
+	PGPASSFILE := os.Getenv("PGPASSFILE")
+
+	if PGHOST != "" {
+		host = PGHOST
+	}
+	if PGUSER != "" {
+		user = PGUSER
+	}
+	if PGPASSWORD != "" {
+		password = PGPASSWORD
+	}
+	if PGDATABASE != "" {
+		dbname = PGDATABASE
+	}
+
+	content, err := os.ReadFile(PGPASSFILE)
+
+	if err != nil {
+		password = string(content)
+	}
+
+	connStr := fmt.Sprintf("postgres://%s:%s@%s/%s?sslmode=disable", user, password, host, dbname)
+	fmt.Println("DEBUGPRINT[395]: SSTorytime.go:521: connStr= ", connStr)
 
         sst.DB, err = sql.Open("postgres", connStr)
 
-- 
2.50.1

